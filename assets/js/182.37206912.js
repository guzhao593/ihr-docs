(window.webpackJsonp=window.webpackJsonp||[]).push([[182],{696:function(s,t,a){"use strict";a.r(t);var n=a(30),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"功能权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#功能权限"}},[s._v("#")]),s._v(" 功能权限")]),s._v(" "),a("p",[a("code",[s._v("i-toolbar")]),s._v(" 提供了 "),a("code",[s._v("filterTool")]),s._v(" 方法用于过滤工具集合，但实际上在业务开发过程中，我们更多的是直接操作数组 "),a("code",[s._v("tools")]),s._v(" 的方式实现的。那么这个方法是否能够结合「功能权限」使用呢？")]),s._v(" "),a("h3",{attrs:{id:"问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题")]),s._v(" "),a("p",[s._v("在过去，我们要实现某个按钮的显示隐藏，需要全局或者逐个页面注入「权限 "),a("code",[s._v("mixin")]),s._v("」，再在每个按钮上面绑定 "),a("code",[s._v("key")]),s._v(" 之余，还要写上 "),a("code",[s._v("v-if")]),s._v(" 和权限变量才能实现。虽然能实现，但显而易见，这种方式算不上好：")]),s._v(" "),a("ol",[a("li",[s._v("不仅需要 "),a("code",[s._v("v-if")]),s._v(" 绑定对应的权限变量，还得跟业务原有的显隐逻辑冗余（类似于 "),a("code",[s._v('v-if="权限变量 && (业务变量A || 业务变量B) && 业务变量C && ..."')]),s._v("）")]),s._v(" "),a("li",[s._v("系统按钮千千万，表格表单占一半。也就意味着要实现同样的逻辑，需要把「权限 "),a("code",[s._v("mixin")]),s._v("」中方法和变量散落得到处都是，再由开发者手动在业务页面中调用")])]),s._v(" "),a("h3",{attrs:{id:"方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方案"}},[s._v("#")]),s._v(" 方案")]),s._v(" "),a("p",[s._v("首先 "),a("code",[s._v("i-toolbar")]),s._v(" 已经集成了 "),a("code",[s._v("Element")]),s._v(" 的按钮、按钮集合、下拉菜单、弹出框，支持自定义渲染，有能力替代项目中单独使用如上组件的场景。并且本身就是数据驱动的，拥有 "),a("code",[s._v("filterTool")]),s._v(" 方法执行过滤，那么是否可以直接在全局定义此方法，实现同样的过滤逻辑呢？答案是肯定的。")]),s._v(" "),a("ol",[a("li",[s._v("开发者在绑定 "),a("code",[s._v("key")]),s._v(" 后只需要关心按钮在业务中显隐逻辑即可")]),s._v(" "),a("li",[s._v("表格表单等一系列 "),a("code",[s._v("Sahara")]),s._v(" 组件的工具区都内置了 "),a("code",[s._v("i-toolbar")]),s._v("，因此该方案能控制所有组件中的按钮显隐，一劳永逸")])]),s._v(" "),a("h3",{attrs:{id:"实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[s._v("#")]),s._v(" 实现")]),s._v(" "),a("p",[s._v("那么实际上我们就是要解决「如何将 "),a("code",[s._v("filterTool")]),s._v(" 的默认行为更改为：根据全局权限状态和 "),a("code",[s._v("key")]),s._v(" 执行过滤」。可以在注册组件之前，通过如下方式改写组件属性的默认值。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 覆盖原始默认值")]),s._v("\nSahara"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Toolbar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("filterTool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("default "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" filterTool\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("由于存在按钮集合、下拉菜单的情况，因此过滤函数需要考虑递归逻辑。实现如下：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Vue "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vue'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Sahara "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@ipeople/sahara'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 请求权限信息至全局状态")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" globalAccessKeys "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fetchAccessKeys")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("filterTool")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("tool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 过滤绑定了 key 但不存在于全局权限 keys 的工具")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" globalAccessKeys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("indexOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 更改 i-toolbar filterTool 属性的默认值")]),s._v("\nSahara"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Toolbar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("filterTool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("default "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" filterTool\n\nVue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Sahara"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("而对于开发者而言，只需要在 "),a("code",[s._v("tools")]),s._v(" 中携带 "),a("code",[s._v("key")]),s._v(" 就行了。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("toolbar "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("tools"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"[{ text: 'Button', key: 'ACCESS_KEY' }]\"")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("toolbar"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[154],{720:function(s,t,a){"use strict";a.r(t);var n=a(30),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"日志使用规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志使用规范"}},[s._v("#")]),s._v(" 日志使用规范")]),s._v(" "),a("h2",{attrs:{id:"日志级别的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志级别的使用"}},[s._v("#")]),s._v(" 日志级别的使用")]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("ERROR")])]),s._v(" "),a("p",[s._v("ERROR级别的日志反映系统发生了非常"),a("strong",[s._v("严重的故障")]),s._v("，"),a("strong",[s._v("无法自动恢复")]),s._v("到正常态工作，"),a("strong",[s._v("需要人工介入处理")]),s._v("。系统需要将错误相关痕迹以及错误细节记录ERROR日志中，方便后续人工回溯解决。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("WARN")])]),s._v(" "),a("p",[s._v("WARN是低级别异常日志，"),a("strong",[s._v("反映系统在业务处理时触发了异常流程，但系统可恢复到正常态")]),s._v("，下一次业务可以正常执行。当功能逻辑走入异常逻辑时，应该考虑记录WARN日志。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("INFO")])]),s._v(" "),a("p",[s._v("INFO日志主要记录系统关键信息，"),a("strong",[s._v("旨在保留系统正常工作期间关键运行指标")]),s._v("，开发人员可以将"),a("strong",[s._v("初始化系统配置")]),s._v("、"),a("strong",[s._v("业务状态变化信息")]),s._v("，或者"),a("strong",[s._v("用户业务流程中的核心处理")]),s._v("记录到INFO日志中，方便日常运维工作以及错误回溯时上下文场景复现。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("DEBUG")])]),s._v(" "),a("p",[s._v("DEBUG日志t通常用于开发人员记录各类详细信息，"),a("strong",[s._v("主要起到调试的作用")]),s._v("，包括参数信息，调试细节信息，返回值信息等等。其他等级不方便显示的信息都可以通过DEBUG日志来记录。")])])]),s._v(" "),a("h2",{attrs:{id:"添加日志的区域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加日志的区域"}},[s._v("#")]),s._v(" 添加日志的区域")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("代码抛出异常")]),s._v("：凡代码抛出异常，不管后续是catch掉还是继续把异常抛出，都需要输出详细错误日志，以便后续追溯；")]),s._v(" "),a("li",[a("strong",[s._v("系统核心流程，业务关键动作")])]),s._v(" "),a("li",[a("strong",[s._v("多分支判断")]),s._v("：多if/else代码区域，建议记录分支判断参数和结果；")]),s._v(" "),a("li",[a("strong",[s._v("数据获取/处理不在预期范围")])]),s._v(" "),a("li",[a("strong",[s._v("业务流程预期不符")]),s._v("：")]),s._v(" "),a("li",[a("strong",[s._v("外部接口")]),s._v("：对外部接口提供尽可能多的日志信息，有利于协助第三方快速排查定位故障；")]),s._v(" "),a("li",[a("strong",[s._v("系统初始化")]),s._v("：核心模块或者组件初始化过程中往往依赖一些关键配置，建议在系统初始化时打印相关配置参数。")])]),s._v(" "),a("h2",{attrs:{id:"日志内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志内容"}},[s._v("#")]),s._v(" 日志内容")]),s._v(" "),a("p",[s._v("一条完整的日志应该是一件事情的概要描述，其中应该的元素应该包括：")]),s._v(" "),a("ul",[a("li",[s._v("日志级别, ERROR/WRAN/INFO/DEBUG")]),s._v(" "),a("li",[s._v("日志时间")]),s._v(" "),a("li",[s._v("概要内容，包括场景信息（什么功能等），状态信息(开始，中断，结束)以及重要参数.")]),s._v(" "),a("li",[s._v("应用标识，方便日志搜索")]),s._v(" "),a("li",[s._v("会话标识，能知道是哪个客户端或者是哪个用户触发，登陆账号，seesion信息等")]),s._v(" "),a("li",[s._v("功能标识，方便日志搜索，跟踪指定功能的完整轨迹")]),s._v(" "),a("li",[s._v("其他信息，其他可能的有用信息包括：代码位置，版本号，线程号等等")])]),s._v(" "),a("p",[s._v("建议日志输出格式如下：")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[s._v("# 除了日志级别和概要内容，其他由系统自动完成\n[日志级别][日志时间][应用标识][请求标识][session-id][线程id][代码位置][概要内容]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"应该避免的错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应该避免的错误"}},[s._v("#")]),s._v(" 应该避免的错误")]),s._v(" "),a("h3",{attrs:{id:"日志丢失"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志丢失"}},[s._v("#")]),s._v(" 日志丢失")]),s._v(" "),a("ul",[a("li",[s._v('禁止使用System.out.println("")打印日志，System.out输出的日志只会出现在控制台，不会被记录到日志文件;')]),s._v(" "),a("li",[s._v("禁止打印异常日志不将异常对象exception返回，exception不返回无法获取异常调用堆栈信息；")])]),s._v(" "),a("h3",{attrs:{id:"性能浪费"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能浪费"}},[s._v("#")]),s._v(" 性能浪费")]),s._v(" "),a("ul",[a("li",[s._v("禁止使用字符串拼接，必须使用占位符方式，以节省某些时候不必要的拼接操作")]),s._v(" "),a("li",[s._v("凡日志打印必有损耗，只打印有必要的日志")])]),s._v(" "),a("h3",{attrs:{id:"直接使用日志系统api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#直接使用日志系统api"}},[s._v("#")]),s._v(" 直接使用日志系统API")]),s._v(" "),a("ul",[a("li",[s._v("禁止直接使用日志系统（Log4j、Logback）中的API，必须使用日志框架SLF4J中的API，使用门面模式的日志框架，有利于维护和各个类的日志处理方式统一；")])]),s._v(" "),a("p",[a("strong",[s._v("推荐直接使用lombak的@Slf4j")])]),s._v(" "),a("h2",{attrs:{id:"java日志代码推荐示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#java日志代码推荐示例"}},[s._v("#")]),s._v(" Java日志代码推荐示例")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Slf4j")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" XXX "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" param"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("debug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"参数param值为[{}]"')]),s._v("， param"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 占位符方式，并且用[]包围，便于后续日志搜索")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 根据实际情况catch对应异常类型")]),s._v("\n      log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"读取文件时发生错误。"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 保留异常堆栈")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h2",{attrs:{id:"日志运维"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志运维"}},[s._v("#")]),s._v(" 日志运维")]),s._v(" "),a("ul",[a("li",[s._v("所有日志至少保留15天，以便后续排查问题需要；")]),s._v(" "),a("li",[s._v("日志需输出到ELK，方便日志快速搜索；")])])])}),[],!1,null,null,null);t.default=r.exports}}]);